<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wxl.cms.dao.AdminDao">

	<select id="userIsExis" resultType="User">
		select * from cms_user where username=#{user.username} and password=#{user.password} and role=1
	</select>
	
	<select id="selectUser" resultType="User">
		select * from cms_user
		<where>
			<if test="keyWord!=null and keyWord!=''">
				and username like '%${keyWord}%'
			</if>
			<if test="nickName!=null and nickName!=''">
				or nickname like '%${nickName}%'
			</if>
		</where>
	</select>
	
	<update id="lockedStatus">
		update cms_user set locked=#{status} where id=#{id}
	</update>
	
	
	<select id="getUserById" resultType="User">
		select * from cms_user where id=#{id}
	</select>
	
	
	<select id="selectChannel" resultType="Channel">
		select * from cms_channel
	</select>
	
	<select id="selectCategory" resultType="Category">
		<if test="channelId!=null and channelId!=''">
			select * from cms_category where channel_id = #{channelId}
		</if>
	</select>
	
	<select id="selectArticle" resultMap="selectArticleMap">
		select cms_article.*,cms_channel.*,cms_category.*,cms_user.*
		from cms_article left join cms_channel on cms_article.channel_id=cms_channel.id
		left join cms_category on cms_article.category_id=cms_category.id
		left join cms_user on cms_article.user_id =cms_user.id
	</select>
	<resultMap type="Article" id="selectArticleMap">
		<id property="id" column="id"/>
		<result property="title" column="title"/> 
		<result property="content" column="content"/>  
		<result property="picture" column="picture"/>
		<result property="hits" column="hits"/>
		<result property="updated" column="updated"/>
		<result property="commentCnt" column="commentCnt"/>
		<result property="hot" column="hot"/> 
		<result property="created" column="created"/> 
		<result property="status" column="status"/> 
		<association property="channel" javaType="Channel">
			<id property="id" column="1id"/>  
			<result property="name" column="name"/>
			<result property="description" column="description"/>
			<result property="icon" column="icon"/>
		</association>
		<association property="category" javaType="Category">
			<id property="id" column="id2"/>
			<result property="name" column="name"/>
			<result property="channel_id" column="channel_id"/>
		</association>
		<association property="user" javaType="User">
			<id property="id" column="id3"/>
			<result property="username" column="username"/>
			<result property="nickname" column="nickname"/>
		</association>
	</resultMap>
</mapper>